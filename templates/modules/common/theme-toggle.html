<div
  x-data="{
  isOpen: false,
  direction: $el.dataset.direction || 'top',
  currentTheme: localStorage.getItem('theme') || 'light',
  dropdownClass() {
    const position = 'top';
    return {
      'bottom-full mb-2': position === 'top',
      'mt-2': position === 'bottom',
      'left-0': position === 'left',
      'right-0': position === 'right'
    };
  },
  menuPosition() {
    if (this.direction === 'auto') {
      const rect = this.$el.getBoundingClientRect();
      return window.innerHeight - rect.bottom < 200 ? 'top' : 'bottom';
    }
    return this.direction === 'top' ? 'bottom' : this.direction;
  },
  init() {
    this.currentTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', this.currentTheme);
    if (this.currentTheme === 'dark') {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  }
}"
  x-init="init"
  class="relative"
  :class="{
    'origin-top': menuPosition() === 'bottom',
    'origin-bottom': 'top' === 'top',
    'origin-left': menuPosition() === 'right',
    'origin-right': menuPosition() === 'left'
  }"
>
  <button
    @click="isOpen = !isOpen"
    class="hover:bg-primary/20 dark:hover:bg-primary/30 inline-flex items-center justify-center rounded-full bg-white/80 p-2 text-gray-600 shadow-lg backdrop-blur-md transition-all duration-200 hover:scale-110 hover:text-primary dark:bg-gray-800/80 dark:text-gray-300"
  >
    <span class="sr-only">切换主题</span>
    <!-- 主题图标 -->
    <svg class="h-5 w-5" viewBox="0 0 16 16">
      <path
        fill="none"
        stroke="#cad3f5"
        stroke-linecap="round"
        stroke-linejoin="round"
        d="m1.875 8l.686-2.743a1 1 0 0 1 .97-.757h10.938a1 1 0 0 1 .97 1.243l-.315 1.26M6 13.5H2.004A1.5 1.5 0 0 1 .5 12V3.5a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1v1"
        stroke-width="1"
      />
      <g fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.4">
        <path
          stroke="#f4dbd6"
          d="M12 21a9 9 0 0 1 0-18c4.97 0 9 3.582 9 8c0 1.06-.474 2.078-1.318 2.828S17.693 15 16.5 15H14a2 2 0 0 0-1 3.75A1.3 1.3 0 0 1 12 21"
          transform="matrix(.41667 0 0 .4167 6.75 6.747)"
        />
        <path
          stroke="#ed8796"
          d="M7.5 10.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
          transform="matrix(.41667 0 0 .4167 6.75 6.747)"
        />
        <path
          stroke="#a6da95"
          d="M11.5 7.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
          transform="matrix(.41667 0 0 .4167 6.75 6.747)"
        />
        <path
          stroke="#8aadf4"
          d="M15.5 10.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
          transform="matrix(.41667 0 0 .4167 6.75 6.747)"
        />
      </g>
    </svg>
  </button>

  <!-- 主题选择下拉菜单 -->
  <div
    x-show="isOpen"
    @click.away="isOpen = false"
    class="absolute right-0 z-[9999] w-48 rounded-lg bg-white py-2 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none dark:bg-gray-800 dark:ring-gray-700"
    :class="dropdownClass()"
    role="menu"
    aria-orientation="vertical"
    aria-labelledby="theme-menu"
  >
    <template x-for="theme in ['light', 'dark', 'spring', 'summer', 'autumn', 'winter', 'myCustom']" :key="theme">
      <button
        @click="
          currentTheme = theme;
          isOpen = false;
          localStorage.setItem('theme', theme);
          document.documentElement.setAttribute('data-theme', theme);
          if (theme === 'dark') {
            document.documentElement.classList.add('dark');
          } else {
            document.documentElement.classList.remove('dark');
          }
        "
        class="flex w-full items-center px-4 py-2 text-sm text-gray-700 transition-colors dark:text-gray-300"
        :class="{
          'bg-gray-100 dark:bg-gray-700': currentTheme === theme,
          'hover:bg-gray-50 dark:hover:bg-gray-700/50': currentTheme !== theme
        }"
        role="menuitem"
      >
        <div class="flex items-center space-x-2">
          <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <template x-if="theme === 'light'">
              <g>
                <path
                  fill="none"
                  stroke="#cad3f5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m1.875 8l.686-2.743a1 1 0 0 1 .97-.757h10.938a1 1 0 0 1 .97 1.243l-.315 1.26M6 13.5H2.004A1.5 1.5 0 0 1 .5 12V3.5a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1v1"
                  stroke-width="1"
                />
                <g fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.4">
                  <path
                    stroke="#f4dbd6"
                    d="M12 21a9 9 0 0 1 0-18c4.97 0 9 3.582 9 8c0 1.06-.474 2.078-1.318 2.828S17.693 15 16.5 15H14a2 2 0 0 0-1 3.75A1.3 1.3 0 0 1 12 21"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                  <path
                    stroke="#ed8796"
                    d="M7.5 10.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                  <path
                    stroke="#a6da95"
                    d="M11.5 7.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                  <path
                    stroke="#8aadf4"
                    d="M15.5 10.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                </g>
              </g>
            </template>
            <template x-if="theme === 'dark'">
              <g>
                <path
                  fill="none"
                  stroke="#cad3f5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m1.875 8l.686-2.743a1 1 0 0 1 .97-.757h10.938a1 1 0 0 1 .97 1.243l-.315 1.26M6 13.5H2.004A1.5 1.5 0 0 1 .5 12V3.5a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1v1"
                  stroke-width="1"
                />
                <g fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.4">
                  <path
                    stroke="#f4dbd6"
                    d="M12 21a9 9 0 0 1 0-18c4.97 0 9 3.582 9 8c0 1.06-.474 2.078-1.318 2.828S17.693 15 16.5 15H14a2 2 0 0 0-1 3.75A1.3 1.3 0 0 1 12 21"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                  <path
                    stroke="#ed8796"
                    d="M7.5 10.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                  <path
                    stroke="#a6da95"
                    d="M11.5 7.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                  <path
                    stroke="#8aadf4"
                    d="M15.5 10.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                </g>
              </g>
            </template>
            <template x-if="theme === 'spring'">
              <g>
                <path
                  fill="none"
                  stroke="#cad3f5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m1.875 8l.686-2.743a1 1 0 0 1 .97-.757h10.938a1 1 0 0 1 .97 1.243l-.315 1.26M6 13.5H2.004A1.5 1.5 0 0 1 .5 12V3.5a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1v1"
                  stroke-width="1"
                />
                <g fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.4">
                  <path
                    stroke="#f4dbd6"
                    d="M12 21a9 9 0 0 1 0-18c4.97 0 9 3.582 9 8c0 1.06-.474 2.078-1.318 2.828S17.693 15 16.5 15H14a2 2 0 0 0-1 3.75A1.3 1.3 0 0 1 12 21"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                  <path
                    stroke="#ed8796"
                    d="M7.5 10.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                  <path
                    stroke="#a6da95"
                    d="M11.5 7.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                  <path
                    stroke="#8aadf4"
                    d="M15.5 10.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                </g>
              </g>
            </template>
            <template x-if="theme === 'summer'">
              <g>
                <path
                  fill="none"
                  stroke="#cad3f5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m1.875 8l.686-2.743a1 1 0 0 1 .97-.757h10.938a1 1 0 0 1 .97 1.243l-.315 1.26M6 13.5H2.004A1.5 1.5 0 0 1 .5 12V3.5a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1v1"
                  stroke-width="1"
                />
                <g fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.4">
                  <path
                    stroke="#f4dbd6"
                    d="M12 21a9 9 0 0 1 0-18c4.97 0 9 3.582 9 8c0 1.06-.474 2.078-1.318 2.828S17.693 15 16.5 15H14a2 2 0 0 0-1 3.75A1.3 1.3 0 0 1 12 21"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                  <path
                    stroke="#ed8796"
                    d="M7.5 10.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                  <path
                    stroke="#a6da95"
                    d="M11.5 7.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                  <path
                    stroke="#8aadf4"
                    d="M15.5 10.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                </g>
              </g>
            </template>
            <template x-if="theme === 'autumn'">
              <g>
                <path
                  fill="none"
                  stroke="#cad3f5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m1.875 8l.686-2.743a1 1 0 0 1 .97-.757h10.938a1 1 0 0 1 .97 1.243l-.315 1.26M6 13.5H2.004A1.5 1.5 0 0 1 .5 12V3.5a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1v1"
                  stroke-width="1"
                />
                <g fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.4">
                  <path
                    stroke="#f4dbd6"
                    d="M12 21a9 9 0 0 1 0-18c4.97 0 9 3.582 9 8c0 1.06-.474 2.078-1.318 2.828S17.693 15 16.5 15H14a2 2 0 0 0-1 3.75A1.3 1.3 0 0 1 12 21"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                  <path
                    stroke="#ed8796"
                    d="M7.5 10.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                  <path
                    stroke="#a6da95"
                    d="M11.5 7.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                  <path
                    stroke="#8aadf4"
                    d="M15.5 10.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                </g>
              </g>
            </template>
            <template x-if="theme === 'winter'">
              <g>
                <path
                  fill="none"
                  stroke="#cad3f5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m1.875 8l.686-2.743a1 1 0 0 1 .97-.757h10.938a1 1 0 0 1 .97 1.243l-.315 1.26M6 13.5H2.004A1.5 1.5 0 0 1 .5 12V3.5a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1v1"
                  stroke-width="1"
                />
                <g fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.4">
                  <path
                    stroke="#f4dbd6"
                    d="M12 21a9 9 0 0 1 0-18c4.97 0 9 3.582 9 8c0 1.06-.474 2.078-1.318 2.828S17.693 15 16.5 15H14a2 2 0 0 0-1 3.75A1.3 1.3 0 0 1 12 21"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                  <path
                    stroke="#ed8796"
                    d="M7.5 10.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                  <path
                    stroke="#a6da95"
                    d="M11.5 7.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                  <path
                    stroke="#8aadf4"
                    d="M15.5 10.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                </g>
              </g>
            </template>
            <template x-if="theme === 'myCustom'">
              <g>
                <path
                  fill="none"
                  stroke="#cad3f5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m1.875 8l.686-2.743a1 1 0 0 1 .97-.757h10.938a1 1 0 0 1 .97 1.243l-.315 1.26M6 13.5H2.004A1.5 1.5 0 0 1 .5 12V3.5a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1v1"
                  stroke-width="1"
                />
                <g fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.4">
                  <path
                    stroke="#f4dbd6"
                    d="M12 21a9 9 0 0 1 0-18c4.97 0 9 3.582 9 8c0 1.06-.474 2.078-1.318 2.828S17.693 15 16.5 15H14a2 2 0 0 0-1 3.75A1.3 1.3 0 0 1 12 21"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                  <path
                    stroke="#ed8796"
                    d="M7.5 10.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                  <path
                    stroke="#a6da95"
                    d="M11.5 7.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                  <path
                    stroke="#8aadf4"
                    d="M15.5 10.5c0 1.333 2 1.333 2 0s-2-1.333-2 0"
                    transform="matrix(.41667 0 0 .4167 6.75 6.747)"
                  />
                </g>
              </g>
            </template>
          </svg>
          <span
            x-text="{
            'light': '浅色',
            'dark': '深色',
            'spring': '春天',
            'summer': '夏天',
            'autumn': '秋天',
            'winter': '冬天',
            'myCustom': '自定义'
          }[theme]"
          ></span>
        </div>
      </button>
    </template>
  </div>
</div>
